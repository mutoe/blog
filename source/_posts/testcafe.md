---
title: testcafe -- ä¸€ä¸ªåŸºäº nodejs è‡ªåŠ¨åŒ–æµ‹è¯•æ¡†æ¶
categories: å¿ƒå¾—
tags:
  - test
  - nodejs
  - testcafe
date: 2018-10-21 21:50:35
update: 2018-10-23 13:16:17
---

# testcafe

testcafe ([å®˜ç½‘](https://devexpress.github.io/testcafe/)) æ˜¯ä¸€ä¸ªåŸºäº nodejs çš„è‡ªåŠ¨åŒ–æµ‹è¯•æ¡†æ¶ï¼Œä¼˜ç‚¹å°±å…ˆä¸å¤šè¯´äº†ï¼Œæˆ‘ä»¬ç›´æ¥è¿›å…¥æ­£é¢˜ï¼

# å®‰è£…

testcafe æ˜¯ä¸€ä¸ª npm åŒ…ï¼Œå®ƒå¯ä»¥ä½¿ç”¨ npm æˆ– yarn åŒ…ç®¡ç†å™¨è¿›è¡Œå®‰è£…ï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ yarn è¿›è¡Œå®‰è£…ï¼ˆå› ä¸ºå®ƒå¾ˆå¿«ï¼‰

åœ¨å‘½ä»¤è¡Œä¸­è¿è¡Œä»¥ä¸‹å‘½ä»¤

``` bash
yarn global add testcafe
```

è¿™æ ·ï¼Œ testcafe å°±å®‰è£…åœ¨ä½ æœ¬æœºä¸Šå•¦

> å¦‚æœä½ çš„æœºå™¨ä¸Šæ²¡æœ‰å®‰è£… yarnï¼Œé‚£ä¹ˆä½ å¯ä»¥ä½¿ç”¨ npm æ¥å®‰è£… yarn ğŸ˜Š
> ``` bash
> npm install -g yarn
> ```

# å°è¯•ç‰›åˆ€

## åˆ›å»ºä¸€ä¸ªæµ‹è¯•é¡¹ç›®

æˆ‘ä»¬æ–°å»ºä¸€ä¸ªç›®å½•ï¼Œç”¨äºç»ƒä¹ æˆ‘ä»¬çš„è‡ªåŠ¨åŒ–æµ‹è¯•æ¡†æ¶ testcafe

``` bash
# é¦–å…ˆåˆ‡æ¢åˆ°ä½ ç”¨äºç®¡ç† web é¡¹ç›®çš„æ ¹ç›®å½•ï¼Œæˆ‘æœ¬æœºæ˜¯ "~/www"
cd ~/www
mkdir testcafe && cd testcafe
```

<!-- more -->

## ç¼–å†™ç¬¬ä¸€ä¸ªæµ‹è¯•è„šæœ¬

ç„¶åæ–°å»ºä¸€ä¸ªåä¸º `myFirstTestcase.js` æ–‡ä»¶ï¼Œç”¨äºç¼–å†™æˆ‘ä»¬çš„è‡ªåŠ¨åŒ–æµ‹è¯•è„šæœ¬

``` bash
vim myFirstTestcase.js # ç”¨ vim æ‰“å¼€è¿™ä¸ªæ–‡ä»¶ï¼ˆå¦‚æœæ–‡ä»¶ä¸å­˜åœ¨å°±åˆ›å»ºå®ƒï¼‰
```

> å¦‚æœä½ å®‰è£…äº† vscodeï¼Œä½ è¿˜å¯ä»¥ä½¿ç”¨ `code myFirstTestcase.js` æ¥åˆ›å»ºå¹¶ç¼–è¾‘å®ƒ
> _éœ€è¦åœ¨ vscode çš„æ§åˆ¶å®ƒä¸­è¾“å…¥ `install command` æ¥å¯ç”¨ `code` å‘½ä»¤_

å°†ä»¥ä¸‹å†…å®¹ç²˜è´´åˆ° `myFirstTestcase.js` ä¸­

``` js
// ES6 å¯¼åŒ…è¯­æ³•
import { Selector } from 'testcafe';

// å£°æ˜ä¸€ä¸ª fixture æµ‹è¯•é¡¹ç›®
fixture('Getting Started')
  // æ‰“å¼€ä¸€ä¸ª web é¡µé¢ç”¨äºæ¥ä¸‹æ¥çš„æµ‹è¯•
  .page('http://devexpress.github.io/testcafe/example')

// åˆ›å»ºä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹
test('My first test', async t => {
  // Test code
});
```

åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬çš„ç¬¬ä¸€ä¸ª test script å°±å†™å¥½äº†ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬æ¥è¿è¡Œå®ƒçœ‹çœ‹

## è¿è¡Œæµ‹è¯•è„šæœ¬

æˆ‘ä»¬å›åˆ°å‘½ä»¤è¡Œä¸­ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤æ¥è¿è¡Œä¸€ä¸ªæµ‹è¯•è„šæœ¬

``` bash
testcafe chrome myFirstTestcase.js
```

> è¿™ä¸ªå‘½ä»¤ä¸­ï¼Œ
> - `testcafe` æ˜¯æˆ‘ä»¬ä½¿ç”¨åŒ…ç®¡ç†å·¥å…·å…¨å±€å®‰è£…çš„ä¾èµ–ï¼Œtestcafe æ˜¯å®ƒçš„å¯æ‰§è¡Œç¨‹åº
> - `chrome` æ˜¯æˆ‘ä»¬çš„æµ‹è¯•å¹³å°ï¼Œå®‰è£…åœ¨æœ¬æœºçš„æµè§ˆå™¨ï¼Œä¹Ÿå¯ä»¥æ˜¯ `safari` `firefox` ç­‰
> - `myFirstTestcase.js` æ˜¯æˆ‘ä»¬ç¼–å†™çš„æµ‹è¯•è„šæœ¬

ç¨ç­‰ç‰‡åˆ»ï¼Œæˆ‘ä»¬çš„æµè§ˆå™¨å°±ä¼šè¢«è‡ªåŠ¨æ‰“å¼€ç„¶åè¿è¡Œæµ‹è¯•è„šæœ¬ï¼Œæœ€åæµè§ˆå™¨è¢«è‡ªåŠ¨å…³é—­ï¼Œåœ¨ç»ˆç«¯ä¸Šç•™ä¸‹äº†æµ‹è¯•ç»“æœã€‚

![test report](//static.mutoe.com/2018/testcafe/test-report.png)

## ç¼–å†™æµ‹è¯•ä»£ç 

åˆšæ‰æˆ‘ä»¬çš„æµ‹è¯•è„šæœ¬åªæ˜¯ç®€å•çš„æ‰“å¼€äº†ä¸€ä¸ªé¡µé¢ï¼Œå®ƒå¹¶æ²¡æœ‰æ‰§è¡Œä»»ä½•åŠ¨ä½œã€‚

> åœ¨æ¥ä¸‹æ¥çš„å‡ ä¸ªä¾‹å­ä¸­ï¼Œä½ å¯ä»¥æ‰“å¼€æµ‹è¯•ç›®æ ‡ç½‘ç«™ [http://devexpress.github.io/testcafe/example](http://devexpress.github.io/testcafe/example) è¿™ä¸ªé¡µé¢ï¼Œç„¶åæ‰“å¼€æ§åˆ¶å°ï¼Œè§‚å¯Ÿå…¶ DOM ç»“æ„ï¼Œå¹¶è¯•ç€æ¨¡æ‹Ÿè„šæœ¬çš„æ“ä½œï¼Œä»¥ä¾¿æ–¹ä¾¿çš„ç†è§£è„šæœ¬çš„å†…å®¹ã€‚

### åœ¨é¡µé¢ä¸Šæ‰§è¡Œæ“ä½œ

æ¥ä¸‹æ¥æˆ‘ä»¬ç®€å•çš„å†™ä¸¤ä¸ªåŠ¨ä½œï¼Œç”¨æ¥å¯¹é¡µé¢è¿›è¡Œæ“ä½œã€‚  
æ‰“å¼€ `myFirstTestcase.js`ï¼Œåœ¨ `test` æ–¹æ³•çš„å›è°ƒå‡½æ•°ä¸­æ·»åŠ ä»¥ä¸‹å†…å®¹

``` diff
  test('My first test', async t => {
-   // Test code
+   await t
+     .typeText('#developer-name', 'John Smith')
+     .click('#submit-button');
  });
```

t æ˜¯æˆ‘ä»¬çš„æµ‹è¯•ç”¨ä¾‹çš„ä¸Šä¸‹æ–‡å¯¹è±¡ï¼Œå®ƒåˆå¾ˆå¤šæ–¹æ³•ï¼Œåœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬è°ƒç”¨äº†å®ƒçš„ `typeText` å’Œ `click` ä¸¤ä¸ªæ–¹æ³•ï¼Œå…¶ä¸­

- `typeText` æ–¹æ³•ç”¨æ¥é”®å…¥æ–‡æœ¬ï¼Œå®ƒæ¥å—ä¸¤ä¸ªå‚æ•°ï¼šç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ selector é€‰æ‹©å™¨ï¼ˆå®ƒçš„è¯­æ³•ç±»ä¼¼ jQuery é€‰æ‹©å™¨çš„è¯­æ³•ï¼‰ï¼›ç¬¬äºŒä¸ªå‚æ•°æ˜¯ä½ è¦é”®å…¥çš„æ–‡æœ¬ï¼›
- `click` æ–¹æ³•ç”¨æ¥æ¨¡æ‹Ÿé¼ æ ‡ç‚¹å‡»ï¼Œå®ƒæ¥å—ä¸€ä¸ªå‚æ•°ï¼Œæ˜¯ä¸€ä¸ª selector é€‰æ‹©å™¨

> æœ‰å…³è¿™ä¸ªä¸Šä¸‹æ–‡å¯¹è±¡çš„æ›´å¤šæ–¹æ³•ï¼Œè¯·å…ˆå‚è€ƒ [TestCafe å®˜æ–¹ API æ‰‹å†Œ](https://devexpress.github.io/testcafe/documentation/test-api/actions/) (å®ƒæ˜¯ä¸€ä¸ªè‹±æ–‡æ–‡æ¡£ï¼Œç¨åæˆ‘ä¼šæ•´ç†å‡ºè¿™ä¸ªæ–‡æ¡£çš„ä¸­æ–‡æ‰‹å†Œåœ¨æœ¬é¡µä¸‹æ–¹)

è¿™æ®µä»£ç çš„ä½œç”¨æ˜¯ï¼š
1. é¦–å…ˆæ‰¾åˆ° id ä¸º `developer-name` çš„æ ‡ç­¾ï¼Œè¾“å…¥å€¼ 'John Smith'
2. ç„¶åç‚¹å‡» id ä¸º `submit-button` çš„æŒ‰é’®

### è§‚å¯Ÿé¡µé¢çš„å˜åŒ–

ä¸Šé¢ä¸€å°èŠ‚æˆ‘ä»¬å¯¹é¡µé¢è¿›è¡Œäº†äº¤äº’ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬æƒ³çŸ¥é“é¡µé¢è¿›è¡Œäº†ä»€ä¹ˆååº”ï¼Œä¹Ÿå°±æ˜¯è§‚å¯Ÿçš„é¡µé¢å˜åŒ–ã€‚

æˆ‘ä»¬å¯¹æµ‹è¯•è„šæœ¬è¿›è¡Œä¿®æ”¹

``` diff
  test('My first test', async t => {
    await t
      .typeText('#developer-name', 'John Smith')
      .click('#submit-button');
+
+   const articleHeader = await Selector('.result-content').find('h1');
+
+   // è·å– article header çš„å†…å®¹æ–‡æœ¬
+   let headerText = await articleHeader.innerText;
  });
```

åœ¨æˆ‘ä»¬ç‚¹å‡»é¡µé¢ä¸Šçš„â€œæäº¤â€æŒ‰é’®åï¼Œä¼šæ‰“å¼€ä¸€ä¸ªâ€œè°¢è°¢â€é¡µé¢ã€‚  
å¦‚æœæˆ‘ä»¬è¦è®¿é—®é¡µé¢ä¸Šçš„ DOM å…ƒç´ ï¼Œå¯ä»¥ä½¿ç”¨æµ‹è¯•è„šæœ¬é¡¶éƒ¨å¯¼å…¥çš„ Selector æ–¹æ³•

1. L6ï¼Œæˆ‘ä»¬å£°æ˜äº†ä¸€ä¸ª `articleHeader` å˜é‡ï¼Œè¿™ä¸ªå˜é‡çš„å€¼æ˜¯æ ¹æ®é€‰æ‹©å™¨ `.result-content > h1` æ‰¾åˆ°çš„ DOM å…ƒç´ 
2. L9ï¼Œæˆ‘ä»¬åˆå£°æ˜äº†ä¸€ä¸ª `headerText` å˜é‡ï¼Œå®ƒçš„å€¼æ˜¯æˆ‘ä»¬è·å–åˆ°çš„ DOM å…ƒç´ çš„ `innerText` å±æ€§ï¼ˆè¿™ä¸ªå±æ€§çš„å€¼æ˜¯ DOM å…ƒç´ çš„å†…å®¹æ–‡æœ¬ï¼‰

### æ–­è¨€

æˆ‘ä»¬æ‹¿åˆ°éœ€è¦åˆ¤æ–­çš„å€¼åï¼Œå°±å¯ä»¥å¯¹æµ‹è¯•ç”¨ä¾‹è¿›è¡Œæ–­è¨€äº†ã€‚  
å®ƒåˆ°åº•èƒ½å¦æ­£ç¡®æ‰§è¡Œæµ‹è¯•ç”¨ä¾‹å¹¶è¾“å‡ºæˆ‘ä»¬æœŸæœ›çš„ç»“æœï¼Ÿ

æˆ‘ä»¬ä½¿ç”¨æµ‹è¯•ç”¨ä¾‹ä¸Šä¸‹æ–‡å¯¹è±¡ `t.expect()` æ–¹æ³•æ¥è¿›è¡Œæ–­è¨€,  
å°†æµ‹è¯•è„šæœ¬æ”¹å†™ä¸ºä»¥ä¸‹å†…å®¹

``` diff
  test('My first test', async t => {
    await t
      .typeText('#developer-name', 'John Smith')
      .click('#submit-button');

-   const articleHeader = await Selector('.result-content').find('h1');
-
-   // è·å– article header çš„å†…å®¹æ–‡æœ¬
-   let headerText = await articleHeader.innerText;
+   // ä½¿ç”¨æ–­è¨€æ–¹æ³•æ¥åˆ¤æ–­æˆ‘ä»¬è·å–åˆ°çš„å€¼ä¸æˆ‘ä»¬æœŸæœ›çš„å€¼æ˜¯å¦ç›¸ç­‰
+   .expect(Selector('#article-header').innerText).eql('Thank you, John Smith!');
  });
```

- L11 `expect()` æ˜¯ä¸€ä¸ª BDDï¼ˆè¡Œä¸ºé©±åŠ¨å¼€å‘ï¼‰é£æ ¼çš„æ–­è¨€æ–¹æ³•, å®ƒæ¥å—ä¸€ä¸ªå‚æ•°ï¼šéœ€è¦è¿›è¡Œæ–­è¨€çš„å˜é‡ï¼›  
  å®ƒè¿”å›ä¸€ä¸ªæ–­è¨€ç±»å®ä¾‹å¯¹è±¡ï¼Œåè·Ÿä¸€ä¸ªæ–­è¨€æ–¹æ³•ã€‚
- `eql()` æ˜¯ä¸€ä¸ªæ–­è¨€æ–¹æ³•ï¼Œç”¨äºåˆ¤æ–­æ–­è¨€å®ä¾‹ä¸æœŸæœ›å€¼æ˜¯å¦ä¸¥æ ¼ç­‰äºï¼Œå®ƒæ¥å—ä¸€ä¸ªå‚æ•°ï¼šæœŸæœ›å€¼ï¼›  
  è¯¥ç±»æ–­è¨€æ–¹æ³•ä¼šåœ¨æ‰“å°å‡ºç›¸åº”çš„æµ‹è¯•æŠ¥å‘Šï¼Œå¦‚æœç›¸ç­‰åˆ™è¿”å› passï¼Œå¦åˆ™æŠ›å‡ºä¸€ä¸ª AssertionError
  
  ![assertion error](//static.mutoe.com/2018/testcafe/assertion-error.png)

## å°ç»“

åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬çš„ç¬¬ä¸€ä¸ªè‡ªåŠ¨åŒ–æµ‹è¯•è„šæœ¬å°±å®Œæˆäº†ï¼Œå¦‚æœä½ æ²¡æœ‰è·‘é€šçš„è¯ï¼Œè¯·æ£€æŸ¥ä¸€ä¸‹ä½ çš„æµ‹è¯•è„šæœ¬æ˜¯å¦ä¸ä»¥ä¸‹å†…å®¹ä¸€è‡´

``` js
// ES6 å¯¼åŒ…è¯­æ³•
import { Selector } from 'testcafe'

// å£°æ˜ä¸€ä¸ª fixture æµ‹è¯•é¡¹ç›®
fixture('Getting Started')
  // æ‰“å¼€ä¸€ä¸ª web é¡µé¢ç”¨äºæ¥ä¸‹æ¥çš„æµ‹è¯•
  .page('http://devexpress.github.io/testcafe/example')

// åˆ›å»ºä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹
test('My first test', async t => {
  await t
    .typeText('#developer-name', 'John Smith')
    .click('#submit-button')

    // ä½¿ç”¨æ–­è¨€æ–¹æ³•æ¥åˆ¤æ–­æˆ‘ä»¬è·å–åˆ°çš„å€¼ä¸æˆ‘ä»¬æœŸæœ›çš„å€¼æ˜¯å¦ç›¸ç­‰
    .expect(Selector('#article-header').innerText).eql('Thank you, John Smith!1')
})

```
