---
title: vi & vim 学习笔记
date: 2017-07-31 13:24:09
update: 2020-06-13 15:12:17
categories: 笔记
tags:
  - Vim
  - Linux
---

(整篇文章都是用 vim 编辑的哦～)

# Vi / Vim 版本的选择

Vim 是 Vi 的升级版本，比 Vi 多了语法高亮等更多特性。就版本而言，软件的新版本往往会修正旧版的一些缺陷和不足，所以说能用新版本尽量使用最新版本。

# 文件

Vim 打开后默认在 normal 模式，要进行文件操作，我们需要进入到命令模式，按下 <kbd>:</kbd> 进入命令模式

## 打开/保存/退出

| 命令                  | 作用                                           |
| --------------------- | ---------------------------------------------- |
| `:w`                  | 保存                                           |
| `:w {filename}`       | 另存为                                         |
| `:1,3w {filename}`    | 将 1-3 行另存为 filename（参考[范围限定符]()） |
| `:1,3w >> {filename}` | 将 1-3 行追加到 filename 末尾                  |
| `:q`                  | 退出（如果有改动则会退出失败）                 |
| `:q!` `ZQ`            | 抛弃修改并退出                                 |
| `:wq`                 | 保存并退出                                     |
| `:x` `ZZ`             | 保存并退出（如果有修改，否则直接退出）         |

## 挂起

### 通过 Vim 命令

| 命令      | 作用                                                                                   |
| --------- | -------------------------------------------------------------------------------------- |
| `:!{cmd}` | 用来执行某一条 shell 命令。如 `:!cat database.conf`                                    |
| `:sh`     | 进入 shell 环境。执行结束需要返回 Vim 编辑环境时，输入 `exit` 或按下 `ctrl + d` 即可。 |

### 通过 Shell 命令

利用 Linux 作业机制，按下 `ctrl + z` 将当前程序放在后台执行。然后使用 `fg` 命令重新回到 Vim 编辑器。
详情参考[Unix 或 Linux 中&、jobs、fg、bg 等命令的使用方法](http://blog.sina.com.cn/s/blog_673ee2b50100iywr.html)

# 跳转

## 光标移动

| 按键（单位从小到大） | 作用                                                 |
| -------------------- | :--------------------------------------------------- |
| `h` / `l`            | 光标向左/右移动                                      |
| `w` `W` / `b` `B`    | 移动到下一个词/上一个词的开头（`W` `B`会忽略连字符） |
| `e` `E`              | 移动到当前词的末尾（`E`会忽略连字符）                |
| `0` / `^` / `$`      | 移动到硬行首/软行首(缩进后)/行尾                     |
| `j` / `k`            | 光标向下/上移动一行                                  |
| `(` / `)`            | 移动到语句的开头/末尾                                |
| `{` / `}`            | 移动到段落的开头/末尾                                |
| `%`                  | 跳转到匹配的括号                                     |
| `20g` `:20`          | 跳转到 20 行                                         |
| `zt` / `zz` / `zb`   | 让光标所在行居于屏幕顶部/中央/底部                   |
| `H` / `M` / `L`      | 跳转到当前屏幕的顶部/中央/底部行                     |
| `Ctrl-y` / `Ctrl-e`  | 向上/下滚一行                                        |
| `Ctrl-u` / `Ctrl-d`  | 向上/下翻半页 (up)                                   |
| `Ctrl-b` / `Ctrl-f`  | 向上/下翻一整页 (backward)                           |
| `gg` `:0` /  `G` `:$` | 跳转到文件开始/末尾                                  |
| `\`.`                | 跳转到光标上一次位置                                 |
| `'.`                 | 跳转到光标上一次位置所处的行                         |
| `Ctrl-I` / `Ctrl-O`  | 向前/后追溯光标位置                                  |

这些操作之前都可以加上数字来控制接下来的操作执行多少次，例如按下`20j`向下跳转 20 行，`5Ctrl-e`向下滚动 5 行

# 编辑

## 编辑模式

刚打开 vim 时处于 normal 模式，我们需要进入编辑模式才可以输入内容。

| 按键      | 作用                                                           |
| --------- | :------------------------------------------------------------- |
| `i` / `a` | 在光标位置前面/后面进入编辑模式                                |
| `I` / `A` | 在软行首/行尾位置进入编辑模式                                  |
| `o` / `O` | 在下一行/上一行新起一行进入编辑模式                            |
| `c`       | 更改当前字符并进入插入模式                                     |
| `s`       | 删除当前字符进入编辑模式                                       |
| `C` `ss`  | 删除当前行进入编辑模式                                         |
| `r` `R`   | 在光标位置进入替换编辑模式，`r` 替换一个字符后自动退出编辑模式 |
| `x` `X`   | 向后删除字符(delete)/退格(backspace)                           |
| `10x`     | 向后删除 10 个字符 (仅限当前行)                                |

在编辑模式下，按下 <kdb>Esc</kbd> 退出编辑模式回到 normal 模式

## 撤销、重做

| 按键     | 作用           |
| -------- | :------------- |
| `u`      | 撤销           |
| `Ctrl-R` | 重做           |
| `.`      | 重复上一次操作 |

## 复制、剪切、粘贴

在 normal 模式下按下`y`进入复制模式，按下`d`进入删除（剪切）模式。接下来只需要跟跳转命令（如`0`(行首) `G`(文件末尾)）即可操作相应的范围

> 需要注意的是，剪切时会将移除的内容放入剪贴板。

| 按键        | 作用                                        |
| ----------- | :------------------------------------------ |
| `yy` `Y`    | 复制当前行                                  |
| `yG`        | 复制到文件末尾                              |
| `y$`        | 复制到行尾                                  |
| `6yy` `y6y` | 复制 6 行                                   |
| `dd`        | 剪切当前行                                  |
| `dw`        | 删除到下一个词的开头                        |
| `d$` `D`    | 剪切到行尾                                  |
| `dG`        | 剪切到文件末尾                              |
| `d10G`      | 剪切当前行到第 10 行                        |
| `J`         | 合并下一行                                  |
| `p` `P`     | 粘贴在光标后面/前面                         |
| `2p`        | 粘贴 2 次                                   |
| `Ctrl-r{x}` | 在编辑模式或命令模式下粘贴 `x` 寄存器的内容 |

你还可以在选区模式下按下 `y` 复制整个选区，按下 `d` 剪切选区

值得注意的是，vim 的剪贴板是带有寄存器（Register）的，类似历史记录功能，你可以将不同的内容复制到某一个寄存器内，粘贴时选择相应的寄存器即可。

要使用寄存器，具体的使用方法是在复制/剪切/粘贴命令前输入`"x`，其中 `x` 可以是 `a-z` 和 `*` 还有 `"`，如果指定为`*`，则指令将会与操作系统进行交互，如果指定为 `"` 则会使用上一次的寄存器。

例如输入 `"*p` 就会把系统的剪贴板的内容粘贴到编辑器中。

## 文本对象

Vim 的智能之处在于它知道你的内容如何进行范围的界定，通过以下命令的 combo 来高效的进行编辑

`{command}[inner|a]{scope}`

也就是说，除了 `dd` `yy` 这种命令之外，任何命令包括 `y` `d` `s` `c`

| 按键 | 作用                                                |
| ---- | :-------------------------------------------------- |
| `iw` | "inner word" 选择内联单词                           |
| `it` | "inner tag" 选择内联 tag (指的是 xml/html 标签内容) |
| `i"` | "inner quotes" 选择内联引号                         |
| `ip` | "inner paragraph" 选择内联段落                      |
| `is` | "inner sentence" 选择内联句子                       |
| `as` | "a sentence" 选择一个句子                           |

## 大小写转换

| 按键  | 作用                           |
| ----- | :----------------------------- |
| `~`   | 将光标位置的字母大小写互换     |
| `guw` | 将光标位置的单词变为小写       |
| `gUw` | 将光标位置的单词变为大写       |
| `guu` | 将当前行所有字母变为小写       |
| `gUU` | 将当前行所有字母变为大写       |
| `g~~` | 将当前行所有字母变为大小写互换 |

## 查找

在 normal 模式下直接按下 `/` 或 `?`，然后输入要搜索的关键字按下回车即可。(`/`是向下查找，`?`是向上查找)

查找支持正则表达式，如果需要特殊字符，则需要 `\` 转义。

查找默认大小写敏感，可以在末尾加入 `\c` 忽略大小写

| 命令                   | 作用                                           |
| ---------------------- | :--------------------------------------------- |
| `/{word}`              | 向下查找 word                                  |
| `?{word}`              | 向上查找 word                                  |
| `*` `g*`               | 查找光标所在位置的单词（`g*`忽略忽略单词边界） |
| `n` `N`                | 查找下/上一个（在`?`搜索下是相反的）           |
| `:nohighlight` `:nohl` | 取消搜索高亮显示                               |

上面的查找是跨行的，如果你想要在行内进行查找，可以使用 `f` `F` `t` `T` 命令

| 命令           | 作用                                         |
| -------------- | :------------------------------------------- |
| `f{x}` /`F{x}` | 查找右/左边的 `{x}` 字符                     |
| `t{x}` /`T{x}` | 查找右/左边的 `{x}` 字符, 光标定位在字符左边 |
| `;` `,`        | 查找下/上一个（在 `F` `T` 搜索下是相反的）   |

## 替换

在命令模式下按下<kbd>:</kbd>，然后输入`s`字符进入替换模式，相关语法如下

```vim
:{scope}s/{regexp}/{result}/{flag}
```

其中`scope`为替换的作用域，`regexp`为正则表达式，`result`为要替换的结果，`flag` 为替换标志

例如 `:.,+6s/foo/bar/g` 的意思为，在当前行及下 6 行的范围内(`.,+6`)将所有的(`g`)`foo`替换为`bar`，

### 作用域

- `.`(或留空) 当前行
- `%` 全文
- `,`范围
- `1,$` 第 1 行到最后一行
- `.,+2` 当前行与接下来 2 行
- `'<,'>` 选区范围 （在 visual 模式下输入`:`会直接补全）

### 替换标志

替换标志可以叠加使用

- `(留空)` 只替换一次
- `g` 全局替换
- `i` 忽略大小写
- `c` 替换前确认

进行替换确认时，`y` `n` 表示替换/不替换当前位置，`a` `q` 表示替换/不替换所有，`l` 表示替换当前位置并退出

<!-- # 宏 -->

# 配置

关于配置，可以进入命令模式输入 `set` 来临时设置配置，也可以配置在 `.vimrc` 永久生效

| 配置名       | 说明                                                                   |
| ------------ | :--------------------------------------------------------------------- |
| `ignorecase` | 设置默认进行大小写不敏感查找                                           |
| `smartcase`  | 如果有一个大写字母，则切换到大小写敏感查找                             |
| `incsearch`  | 敲键的同时搜索，按下回车把移动光标移动到匹配的词； 按下 Esc 取消搜索。 |
| `wrapscan`   | 设置到文件尾部后是否重新从文件头开始搜索                               |

# 小技巧

1. 用剪贴板中的内容替换当前光标处的单词

`viwp`

# 参考资料

- [Linux vim - Runoob](https://www.runoob.com/linux/linux-vim.html)
- [技巧：快速提高 Vi/Vim 使用效率的原则与途径 - 方吾松](https://www.ibm.com/developerworks/cn/linux/l-cn-tip-vim/)
- [在 Vim 中优雅地查找和替换 - Harttle Land](https://harttle.land/2016/08/08/vim-search-in-file.html)
- [You don't need more than one cursor in vim - @schoteffel](https://medium.com/@schtoeffel/you-don-t-need-more-than-one-cursor-in-vim-2c44117d51db)
- [Macros - Vim Tips Wiki](https://vim.fandom.com/wiki/Macros)
- [Replace a word with yanked text - Vim Tips Wiki](https://vim.fandom.com/wiki/Replace_a_word_with_yanked_text)
- [Vim 全局命令 g - Ein Verne's Blog](http://einverne.github.io/post/2017/10/vim-global.html)
- [Vim Text Objects: The Definitive Guide - Carbon Five's Blog](https://blog.carbonfive.com/vim-text-objects-the-definitive-guide/)
- [Vim: Jump Back To Previous or Last Cursor Position - nixCraft](https://www.cyberciti.biz/faq/unix-linux-vim-go-back-to-last-cursor-position/)
