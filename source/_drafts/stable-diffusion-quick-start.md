---
title: Stable Diffusion 速查手册
date: 2023-08-19 09:30:00
categories: 教程
tags:
  - AI
  - AI 绘图
  - Stable diffusion
---

本文更新时间：2023-08-20

# 高清修复、无损放大

如果需要生成高清大图，那么不能直接将生成的图像分辨率调大，因为这样会生成一张大图，但是会出现奇怪的内容，比如多个人，或者连踢人，另外大分辨率的图像还很吃显存。

所以如果我们需要文生图(text2image)的高清修复，那么需要先生成500-1000px左右的图像，然后再将这个图使用图生图(image2image)放大到我们需要的分辨率。

下面会介绍三种图像放大的方法。如果你不知道怎么选，推荐使用第2种方法（使用图生图进行超分辨率重绘）或第5种方法（使用 Tiled Diffusion 插件），它们可以在放大添加细节的同时，不容易出现奇怪的内容。

这里是五种放大方法的总结：

| 方法                | 速度 | 生成质量 | 小结                                                |
|-------------------|----|------|---------------------------------------------------|
| 文生图高清修复           | 慢  | 高    | - 简单<br/>- 可选项较少<br/>- 只能用于文生图                    |
| 图生图重绘             | 中  | 高    | - 可以使用底图进行参考重绘<br/>- 使用照片放大时，需要多试几种模型<br/>- 绘制细节多 |
| 后期处理              | 快  | 中    | - 可以对照片进行放大<br/>- 放大到一定程度时不会有更多细节，会出现虚化的边缘        |
| SD upscale<br/>脚本 | 中  | 较低   | - 简单<br/>- 可选项                                    |
| Tiled Diffusion   | 慢  | 高    |                                                   |

## 1. 文生图高清修复 (hires fix)

第一种方法在文生图时直接使用高清修复选项。该方法会花费额外的时间进行生成，你可以理解为在生成的过程中，自动的将低分辨率的图片进行了一次图生图操作。

这种方法的缺点时每次出图的时间会是不使用高清修复的两倍还多，所以建议在文生图时不要使用高清修复选项，而是在生成的图像中选择一张质量较高、构图符合预期的图像，然后使用图生图进行放大。

## 2. 图生图重绘 (image2image repaint)

图生图重绘放大的原理是，基于原图和prompt，加上设定的[重绘幅度](#denoising-重绘幅度)，可以将低分辨率的图像放大到高分辨率，自动添加细节，使得放大后的图像更加清晰，而不会使画面变得模糊。

你只需要将重绘尺寸
图生图中最重要的设定便是[放大器](#upscaler-放大器)，写实模型可以使用 `4x-Ultrasharp` `R-ESRGAN 4x+`，卡通模型可以使用 `R-ESRGAN 4x+ Anime6B`

## 3. 后期处理 (post effects)

后期处理位于tab中，是指在生成图像后，只使用放大器对图像进行放大。在这里你可以选择至多2中放大器同时进行放大，调节他们的权重。

这种放大方法使用场景大多是使用高清放大器时可以参杂一些其他的模糊放大器，使最终产生的图片更加真实。你可以理解它是一种重绘幅度为 0 的图生图放大，由于不需要重绘，所以速度会比图生图快很多。

## 4. SD upscale 脚本

SD upscale 脚本位于图生图底部的脚本下拉框中，它与直接图生图不同的是，它重绘的原理是将原图分成多个小块，然后对每个小块进行重绘，最后再将小块拼接起来，这样可以让图像的细节更加丰富，尤其是在对于人脸和手部等占画面比例较小的部分。

在 Tiled Diffusion 插件出现后，可以使用该插件代替这个脚本。

## 5. Tiled Diffusion

Tiled Diffusion 是一种新的生成方式，类似于 SD upscale，它可以在生成图像时，将图像分成多个小块，然后对每个小块进行生成，最后再将小块拼接起来。

不同于 SD upscale，Tiled Diffusion 的功能更加强大，不仅可以设置分块重叠的宽度，还可以设置分块大小和增加噪声。如果你需要生成4K甚至8K的图像，那么 Tiled Diffusion 绝对是一个不错的选择。

在使用时，需要配合 Tiled VAE 一起使用。

# 局部重绘 (in-painting)
## 图像扩充 (out-painting)

# 名词解释

## Upscaler 放大器

在后期处理或 Tiled Diffusion 中，放大器 (Upscaler) 是指将低分辨率的图像放大到高分辨率的图像的函数。

如果你的底模 (Checkpoint) 有推荐的放大器，那么可以直接使用，否则可以参考下面的推荐。

- 写实：`4x-Ultrasharp` `R-ESRGAN 4x+`
- 卡通：`R-ESRGAN 4x+ Anime6B`

> `4x-Ultrasharp` 不是 sd-web-ui 内置的放大器，需要在[这里](https://huggingface.co/lokCX/4x-Ultrasharp/tree/main)下载

## Denoising 重绘幅度

图生图中，重绘幅度表示基于原图的重绘程度，重绘幅度越大，生成的图像越不像原图，但是也越脱离原图的限制，生成的图像也越有创造性。

建议这个重绘幅度控制在 `0.3`-`0.5` 会更像原图，`0.5`-`0.7` 会更有创造性。
然而，过低的重绘幅度会导致放大时不能添加更多细节，过高会出现奇怪的内容。

![不同的重绘幅度产生的效果](https://static.mutoe.com/2023/stable-diffusion-quick-start/denoising.jpg)
